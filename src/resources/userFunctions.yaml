AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: >
    zoomit-be

    Nested stack functions

Globals:
    Function:
        Timeout: 30
        Tracing: Active
        LoggingConfig:
            LogFormat: JSON
        Environment:
            Variables:
                POSTGRES_USER: !Ref POSTGRES_USER
                POSTGRES_PASSWORD: !Ref POSTGRES_PASSWORD
                POSTGRES_PORT: !Ref POSTGRES_PORT
                POSTGRES_HOST: !Ref POSTGRES_HOST
                POSTGRES_DB: !Ref POSTGRES_DB
                STAGE_NAME: !Ref STAGE_NAME
                JWT_REFRESH_SECRET: !Ref JWT_REFRESH_SECRET
                JWT_ACCESS_SECRET: !Ref JWT_ACCESS_SECRET

Parameters:
    POSTGRES_USER:
        Type: String
        Description: DB Username
    POSTGRES_PASSWORD:
        Type: String
        Description: DB Password
    POSTGRES_PORT:
        Type: String
        Description: DB Port
    POSTGRES_HOST:
        Type: String
        Description: DB Host
    POSTGRES_DB:
        Type: String
        Description: DB Name
    STAGE_NAME:
        Type: String
        Description: Stage name
    JWT_REFRESH_SECRET:
        Type: String
        Description: JWT refresh token secret
    JWT_ACCESS_SECRET:
        Type: String
        Description: JWT access token secret

Resources:
    AuthLoginFunction:
        Type: AWS::Serverless::Function
        Properties:
            CodeUri: ../
            Handler: auth.loginHandler
            Runtime: nodejs20.x
            Architectures:
                - arm64
            Events:
                HelloWorld:
                    Type: Api
                    Properties:
                        Path: /auth/login
                        Method: post
        Metadata:
            BuildMethod: esbuild
            BuildProperties:
                Minify: true
                Target: es2020
                Sourcemap: true
                EntryPoints:
                    - functions/auth.ts
    AuthSignupFunction:
        Type: AWS::Serverless::Function
        Properties:
            CodeUri: ../
            Handler: auth.signupHandler
            Runtime: nodejs20.x
            Architectures:
                - arm64
            Events:
                HelloWorld:
                    Type: Api
                    Properties:
                        Path: /auth/signup
                        Method: post
        Metadata:
            BuildMethod: esbuild
            BuildProperties:
                Minify: true
                Target: es2020
                Sourcemap: true
                EntryPoints:
                    - functions/auth.ts
    AuthRefreshTokenFunction:
        Type: AWS::Serverless::Function
        Properties:
            CodeUri: ../
            Handler: auth.refreshTokenHandler
            Runtime: nodejs20.x
            Architectures:
                - arm64
            Events:
                HelloWorld:
                    Type: Api
                    Properties:
                        Path: /auth/refresh-token
                        Method: post
        Metadata:
            BuildMethod: esbuild
            BuildProperties:
                Minify: true
                Target: es2020
                Sourcemap: true
                EntryPoints:
                    - functions/auth.ts
    AuthNicknameFunction:
        Type: AWS::Serverless::Function
        Properties:
            CodeUri: ../
            Handler: auth.nicknameHandler
            Runtime: nodejs20.x
            Architectures:
                - arm64
            Events:
                HelloWorld:
                    Type: Api
                    Properties:
                        Path: /auth/nickname
                        Method: post
        Metadata:
            BuildMethod: esbuild
            BuildProperties:
                Minify: true
                Target: es2020
                Sourcemap: true
                EntryPoints:
                    - functions/auth.ts
Outputs:
